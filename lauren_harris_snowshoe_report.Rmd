---
title: "Snowshoe report"
author: "Lauren Harris"
date: "11/4/2021"
output: 
  html_document: 
    toc: yes
    number_sections: yes
    theme: lumen
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(here)
library(tidyverse)
library(lubridate)
library(dplyr)
library(kableExtra)
library(effsize)
```

# Introduction

A 4 - 5 sentence "mini-introduction" to what this study is exploring, including basic background information about the subject, site and study (with citations as needed), and a brief overview of what is included in the exploratory report. You should probably do this last so you know whatâ€™s contained in the report

# Data and Analyses

A 3 - 4 sentence section in which you briefly describe the data, including citation & credit as needed, and provide an overview of the main analysis, statistical methods and tools used.

# Juvenile Hare Initial Investigation

## Annual Juvenile Hare Trap Counts
```{r}
# read in data
hares <- read_csv(here("data", "bonanza_hares.csv"))

# reduce data set to juvenile hares only and translate dates into years
juvenile_hares <- hares %>% 
  filter(age == "j") %>% 
  mutate(date = mdy(date)) %>% 
  mutate(year = year(date))

ggplot(data = juvenile_hares, aes(x = year)) +
  geom_bar() +
  labs(x = "Year", y = "Juvenile Hares Trapped") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90)) +
  scale_x_continuous(breaks = seq(from = 1999, to = 2012, by = 1))
  
```

**Figure 1.** Annual juvenile hare trap counts. Annual counts of trapped juvenile hares from the Bonanza Creek Experimental Forest LTER site. (`r min(juvenile_hares$year)`-`r max(juvenile_hares$year)`). Data: Kielland et al. 2017. 

```{r}
# find counts of juvenile hares by year
juvenile_hares_summary <- juvenile_hares %>% 
  group_by(year) %>% 
  summarize(count = n())

# find mean and median counts of juvenile hares trapped 
juvenile_hares_stats <- juvenile_hares_summary %>% 
  summarize(
    mean = mean(count), 
    median = median(count))
```

### Summary

The minimum count of juvenile hares trapped for a given year was 0 (2002 and 2009), and the maximum was `r max(juvenile_hares_summary$count)` hares trapped, during `r juvenile_hares_summary[juvenile_hares_summary$count == max(juvenile_hares_summary$count), ]$year`. The median number of juvenile hares trapped annually was `r juvenile_hares_stats$median` hares and the mean was `r juvenile_hares_stats$mean` hares. One notable trend in the data is that the number of juvenile hares trapped annually generally decreased per year. I would suggest that the amount of traps set be included in this dataset. Then, the number of juveniles trapped should be divided by the number of traps set. Therefore, the absolute counts would become success rates, which are more standardized, informative, and reflective of true hare populations. 

## Juvenile Hare Weights

```{r}
# group juvenile hares by sex and site, then get sample sizes and weights, then make sex and grid variables presentable
juv_hares_sex_site <- juvenile_hares %>% 
  group_by(sex, grid) %>% 
  summarize(count = n(), weight) %>% 
  mutate(sex = case_when(
    sex %in% "f" ~ "Female", 
    sex %in% "m" ~ "Male", 
    sex %in% NA ~ "Sex Unknown")) %>% 
  mutate(grid = case_when(
    grid %in% "bonbs" ~ "Bonbs",
    grid %in% "bonmat" ~ "Bonmat",
    grid %in% "bonrip" ~ "Bonrip"
  ))

ggplot(data = juv_hares_sex_site, aes(x = weight, y = count)) +
  geom_col(width = 20) +
  facet_grid(sex~grid) +
  labs(x = "Weight (g)", y = "Juvenile Hares Trapped" )
```

**Figure 2.** Distribution of weights for juvenile hares (g) from Bonanza Creek Experimental Forest LTER site (`r min(juvenile_hares$year)`-`r max(juvenile_hares$year)`). Hares are grouped by sex and site. Data: Kielland et al. 2017. 

**Table 1.** Summary statistics of weights of juvenile hares from Bonanza Creek Experimental Forest LTER site (`r min(juvenile_hares$year)`-`r max(juvenile_hares$year)`). Hares are grouped by sex and site. Statistics include mean (g), standard deviation (g), and sample size. Data: Kielland et al. 2017.  

```{r}
# find mean, standard deviation and sample size for weights of juvenile hares
juv_hares_sex_site_stats <- juv_hares_sex_site %>% 
  group_by(sex, grid) %>% 
	summarise(mean = mean(weight, na.rm = TRUE),
	          sd = sd(weight, na.rm = TRUE),
	          n = n()) 

# make table of mean, standard deviation and sample size for juvenile hare weights
juv_hares_sex_site_stats %>% 
  kable(col.names = c("Sex", "Site", "Mean (g)", "Standard Deviation (g)", "Sample Size")) %>% 
  kable_styling(full_width = FALSE) %>% 
  column_spec(1:5, color = "black") %>% 
  row_spec(4:6, background = "lightgray")

```

### Summary

Then, in 2 - 3 sentences below your visualization(s) describe in text the main takeaways that you would want the audience to understand from your figures.

## Juvenile Weight Comparison By Sex

**Table 2.** Weights of juvenile hares from Bonanza Creek Experimental Forest LTER site (`r min(juvenile_hares$year)`-`r max(juvenile_hares$year)`) grouped by sex. Summary statistics include mean (g), standard deviation (g), and sample size. Data: Kielland et al. 2017. 

```{r}
# group juvenile hares by sex then find mean, standard deviaiton and sample size for weights
juv_sex_stats <- juvenile_hares %>% 
  group_by(sex) %>% 
	summarise(mean = mean(weight, na.rm = TRUE),
	          sd = sd(weight, na.rm = TRUE),
	          n = n()) 

# make sex values presentable then make a table
juv_sex_stats %>% 
  mutate(sex = case_when(
    sex %in% "f" ~ "Female", 
    sex %in% "m" ~ "Male", 
    sex %in% NA ~ "Sex Unknown")) %>%
  kable(col.names = c("Sex", "Mean (g)", "Standard Deviation (g)", "Sample Size")) %>% 
  kable_styling(full_width = FALSE)

```

```{r, include = FALSE}
# subset data for juvenile hares by sex
juv_hares_f <- juvenile_hares %>% 
  filter(sex == "f") %>% 
  select(weight)

juv_hares_m <- juvenile_hares %>% 
  filter(sex == "m") %>% 
  select(weight)

# find mean weights for males and females
f_juv_mean <- mean(juv_hares_f$weight, na.rm = TRUE)
m_juv_mean <- mean(juv_hares_m$weight, na.rm = TRUE)

# exploratory tests before running t-test

# histograms
ggplot(data = juv_hares_f, aes(x = weight))+
  geom_bar()

ggplot(data = juv_hares_m, aes(x = weight))+
  geom_bar()

# qq plots
ggplot(data = juv_hares_f, aes(sample = weight))+
  geom_qq()

ggplot(data = juv_hares_m, aes(sample = weight))+
  geom_qq()

# create dataframe with males and females together
juv_hares_f_m <- juvenile_hares %>%
  filter(sex == "m" | sex == "f") %>% 
  select(sex, weight)

# subset data with males and females but use pull() so I can run tests on it
juv_hares_f_pull <- juvenile_hares %>% 
  filter(sex == "f") %>% 
  pull(weight) %>% 
  na.omit()

juv_hares_m_pull <- juvenile_hares %>% 
  filter(sex == "m") %>% 
  pull(weight) %>% 
  na.omit()

# effect size with cohen's d
juv_hares_cohen <- cohen.d(juv_hares_m_pull, juv_hares_f_pull)

# t test, two samples but unpaired
juv_hares_ttest <- t.test(juv_hares_m, juv_hares_f)
```

The mean weight of female hares is `r round(f_juv_mean, 2)` g, which is `r round((1-(f_juv_mean/m_juv_mean))*100, 2)`% smaller than the mean weight of male hares at `r round(m_juv_mean, 2)` g. The actual difference in mean weights is `r m_juv_mean - f_juv_mean` g. The effect size is `r round(juv_hares_cohen$estimate, 3)`, which is not very large - the means are pretty close together. A t-test was performed which purported a `r round((juv_hares_ttest$p.value)*100, 2)`% chance of finding means at least this different, if they are drawn from populations with the same mean. 

## Relationship Between Juvenile Weight & Hind Foot Length

```{r}
# data set with juvenile hares' weights and foot lengths 
juv_weight_foot <- juvenile_hares %>% 
  select(weight, hindft)

# plotting the relationship between juvenile weight & hind foot length
ggplot(data = juv_weight_foot, aes(x = hindft, y = weight)) +
  geom_point() +
  labs(x = "Hind Foot Length (mm)", y = "Body Weight (g)")
```

**Figure 3.** Relationship of hind foot length (mm) and body weight (g) of juvenile hares from Bonanza Creek Experimental Forest LTER site (`r min(juvenile_hares$year)`-`r max(juvenile_hares$year)`). Data: Kielland et al. 2017. 

```{r}
# trying out a linear model because boss said so
juv_hares_lm <- lm(weight ~ hindft, data = juv_weight_foot)
summary(juv_hares_lm)
```

# Summary


# Citations
